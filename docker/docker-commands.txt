##### Docker and Git commands cheatsheet version 21 #####

##### Container prep commands #####
ssh -i C:\Users\david.lowe\.ssh\DA-KP-Bastion.pem ec2-user@ec2-35-170-217-54.compute-1.amazonaws.com

scp conda_env.txt docker@10.0.5.72:/home/docker
scp .Renviron docker@10.0.5.73:/home/docker
scp id_rsa docker@10.0.5.72:/home/docker
scp Dockerfile docker@10.0.5.72:/home/docker

ssh -T git@github.com

git clone git@github.com:daines-analytics/deep-learning-projects.git
git clone git@github.com:daines-analytics/tabular-data-projects.git
git clone git@github.com:daines-analytics/template-latest.git
git clone git@github.com:daines-analytics/time-series-projects.git
git clone git@github.com:daines-analytics/under-development.git
git clone git@github.com:daines-analytics/web-scraping-projects.git

git fetch --all ; git reset --hard origin/master

openssl pkcs8 -in <KEYFILENAME> -nocrypt -topk8 -outform DER | openssl sha1 -c

cat train.csv.gz.* > ./train.csv.gz ; gzip -d train.csv.gz


##### Anaconda container commands #####
docker image build -t anaconda/nonroot:v2 .

docker container run --rm -it --env-file conda_env.txt -p 8080:8080 --name jupyter-server anaconda/nonroot:v2 /bin/bash

/opt/conda/bin/jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/anaconda

/opt/conda/bin/jupyter notebook password  # Run server at least once first!

jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp mycontainer:/home/anaconda/under-development/<folder>/<file>.ipynb ./


##### RStudio container commands #####
docker image build -t rstudio/nonroot:v2 .

docker container run --rm -e PASSWORD=rserver -p 8787:8787 --name rstudio-server rstudio/nonroot:v2

docker cp mycontainer:/home/rstudio/under-development/<folder>/<file>.Rmd ./


##### Python container commands #####
docker image build -t pythonml/nonroot:v1 .

docker container run --rm -it --env-file conda_env.txt -p 8080:8080 --name jupyter-server pythonml/nonroot:v1 /bin/bash

jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/pythonml

jupyter notebook password  # Run server at least once first!

jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp mycontainer:/home/pythonml/under-development/<folder>/<file>.ipynb ./


##### Docker CE Installation on CentOS #####
$ sudo yum install -y yum-utils device-mapper-persistent-data lvm2

$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

$ sudo yum install -y docker-ce docker-ce-cli containerd.io

$ sudo systemctl start docker

$ sudo systemctl enable docker

$ sudo docker run hello-world

$ sudo groupadd docker # Might not be necessary - Check first
$ sudo usermod -aG docker $USER # Might not be necessary - Check first


##### Docker REMOVAL ONLY #####
$ sudo yum remove docker-ce

$ sudo rm -rf /var/lib/docker


##### AWS EC2 Setup for FastAI #####
ssh -i ~/.ssh/da-ml-keypair.pem -L localhost:8888:localhost:8888 ubuntu@<your instance IP>

git clone https://github.com/fastai/course-v3

sudo apt-get update | sudo apt-get upgrade | sudo apt-get autoremove

conda update conda

conda install -c pytorch -c fastai fastai pytorch torchvision cuda92

cd course-v3/nbs/dl1

jupyter notebook
