##### Docker and Git commands cheatsheet version 45 #####

##### SSH connection commands #####
ssh -i C:\Users\david\.ssh\DA-KP-Bastion.pem ec2-user@35.170.217.54
ssh -i ~/.ssh/DA-KP-Bastion.pem ec2-user@35.170.217.54
ssh -i ~/.ssh/da-ml-keypair.pem -L localhost:8888:localhost:8888 ubuntu@<instance IP>
scp -i ~/.ssh/da-ml-keypair.pem C:\Users\user_hhds7y1\docker_setup\anaconda\conda_env.txt ubuntu@<instance IP>:/home/ubuntu


##### Container prep commands #####
scp C:\Users\user_hhds7y1\docker_setup\quantfin\quantfin.env docker@10.0.4.255:/home/docker
scp C:\Users\user_hhds7y1\docker_setup\quantfin\Dockerfile-quantfin.txt docker@10.0.4.255:/home/docker/Dockerfile
scp C:\Users\user_hhds7y1\docker_setup\quantfin\id_rsa_docker docker@10.0.4.255:/home/docker

scp C:\Users\user_hhds7y1\docker_setup\pythonml\pythonml.env docker@10.0.5.0:/home/docker
scp C:\Users\user_hhds7y1\docker_setup\pythonml\Dockerfile-pythonml.txt docker@10.0.5.0:/home/docker/Dockerfile
scp C:\Users\user_hhds7y1\docker_setup\pythonml\id_rsa_docker docker@10.0.5.0:/home/docker

scp C:\Users\user_hhds7y1\docker_setup\anaconda\anaconda.env docker@10.0.5.2:/home/docker
scp C:\Users\user_hhds7y1\docker_setup\anaconda\Dockerfile-anaconda.txt docker@10.0.5.2:/home/docker/Dockerfile
scp C:\Users\user_hhds7y1\docker_setup\anaconda\id_rsa_docker docker@10.0.5.2:/home/docker

scp C:\Users\user_hhds7y1\docker_setup\webscrape\webscrape.env docker@10.0.6.53:/home/docker
scp C:\Users\user_hhds7y1\docker_setup\webscrape\Dockerfile-webscrape.txt docker@10.0.6.53:/home/docker/Dockerfile
scp C:\Users\user_hhds7y1\docker_setup\webscrape\id_rsa_docker docker@10.0.6.53:/home/docker

scp C:\Users\user_hhds7y1\docker_setup\rstudio\.Renviron docker@10.0.5.3:/home/docker
scp C:\Users\user_hhds7y1\docker_setup\rstudio\Dockerfile-rstudio.txt docker@10.0.5.3:/home/docker/Dockerfile
scp C:\Users\user_hhds7y1\docker_setup\rstudio\id_rsa_docker docker@10.0.5.3:/home/docker

ssh -T git@github.com

git clone git@github.com:daines-analytics/development-2021.git
git clone https://github.com/daines-analytics/development-2020.git

git clone git@github.com:daines-analytics/datasets-public.git
git clone git@github.com:daines-analytics/deep-learning-projects.git
git clone git@github.com:daines-analytics/quant-finance-projects.git
git clone git@github.com:daines-analytics/tabular-data-projects.git
git clone git@github.com:daines-analytics/template-latest.git
git clone git@github.com:daines-analytics/time-series-projects.git
git clone git@github.com:daines-analytics/web-scraping-projects.git

git fetch --all ; git reset --hard origin/master

split -b 25M -d -a 3 train.zip train.zip.
cat train.zip.{000..020} > train-new.zip
diff --speed-large-files train.zip train-new.zip
cat train.csv.gz.* > ./train.csv.gz ; gzip -d train.csv.gz


##### Quantfin container commands #####
docker image build -t quantfin/nonroot:v1 .

docker container run --rm -it --env-file quantfin.env -p 8080:8080 --name quantfin-server quantfin/nonroot:v1 /bin/bash

/opt/conda/bin/jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/quantfin

/opt/conda/bin/jupyter notebook password  # Run server at least once first!

/opt/conda/bin/jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp quantfin-server:/home/quantfin/quant-finance-projects/daily-stocks-report/ ./

scp docker@10.0.4.255:/home/docker/daily-stocks-report/*.html ./


##### PythonML container commands #####
docker image build -t pythonml/nonroot:v2 .

docker container run --rm -it --env-file pythonml.env -p 8080:8080 --name pythonml-server pythonml/nonroot:v2 /bin/bash

jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/pythonml

jupyter notebook password  # Run server at least once first!

jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp mycontainer:/home/pythonml/<Git-parent-directory>/<project-folder>/<file>.ipynb ./


##### Anaconda container commands #####
docker image build -t anaconda/nonroot:v3 .

docker container run --rm -it --env-file anaconda.env -p 8080:8080 --name anaconda-server anaconda/nonroot:v3 /bin/bash

/opt/conda/bin/jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/anaconda

/opt/conda/bin/jupyter notebook password  # Run server at least once first!

/opt/conda/bin/jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp mycontainer:/home/anaconda/<Git-parent-directory>/<project-folder>/<file>.ipynb ./


##### Webscrape container commands #####
docker image build -t webscrape/nonroot:v1 .

docker container run --rm -it --env-file webscrape.env -p 8080:8080 --name webscrape-server webscrape/nonroot:v1 /bin/bash

jupyter lab --ip=0.0.0.0 --port=8080 --no-browser --notebook-dir=/home/webscrape

/opt/conda/bin/jupyter nbconvert --to html SCRIPT_NAME.ipynb

docker cp mycontainer:/home/webscrape/<Git-parent-directory>/<project-folder>/<file>.ipynb ./


##### RStudio container commands #####
docker image build -t rstudio/nonroot:v2 .

docker container run --rm -e PASSWORD=rserver -p 8787:8787 --name rstudio-server rstudio/nonroot:v2

docker cp mycontainer:/home/rstudio/<Git-parent-directory>/<project-folder>/<file>.Rmd ./


##### AWS Ubuntu AMI commands #####
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --notebook-dir=/home/ubuntu


##### FastAI AWS Deep Learning AMI (Ubuntu) commands #####
$ git clone https://github.com/fastai/course-v3
$ conda update conda
$ conda install -c pytorch -c fastai fastai pytorch
$ cd course-v3/nbs/dl1
$ jupyter notebook


##### Docker CE Installation on CentOS #####
$ sudo yum update -y

$ sudo yum install -y yum-utils device-mapper-persistent-data lvm2

$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

$ sudo yum install -y docker-ce docker-ce-cli containerd.io

$ sudo systemctl start docker

$ sudo systemctl enable docker

$ docker image ls

$ sudo groupadd docker # Might not be necessary - Check first
$ sudo usermod -aG docker $USER # Might not be necessary - Check first
$ docker run hello-world - Check first


##### Docker REMOVAL ONLY #####
$ sudo yum remove docker-ce

$ sudo rm -rf /var/lib/docker


##### AWS EC2 Setup for FastAI #####
sudo apt-get update | sudo apt-get upgrade | sudo apt-get autoremove

git clone https://github.com/daines-analytics/template-latest.git

git clone https://github.com/daines-analytics/deep-learning-projects.git

git clone https://github.com/fastai/course-v3

for TensorFlow(+Keras2) with Python3 (CUDA 10.0 and Intel MKL-DNN) -> source activate tensorflow_p36
for PyTorch with Python3 (CUDA 10.0 and Intel MKL) -> source activate pytorch_p36

conda update conda

conda install -c pytorch -c fastai fastai pytorch torchvision cuda92

cd course-v3/nbs/dl1

source ./conda_unix.txt
jupyter notebook


##### AWS EC2 Setup for TensorFlow on Ubuntu
sudo apt-get update
sudo apt-get upgrade -y

# Add NVIDIA package repositories
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-repo-ubuntu1804_10.0.130-1_amd64.deb
sudo dpkg -i cuda-repo-ubuntu1804_10.0.130-1_amd64.deb
sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub
sudo apt-get update
wget http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64/nvidia-machine-learning-repo-ubuntu1804_1.0.0-1_amd64.deb
sudo apt install ./nvidia-machine-learning-repo-ubuntu1804_1.0.0-1_amd64.deb
sudo apt-get update

# Install NVIDIA driver
# sudo apt-get install --no-install-recommends nvidia-driver-418
sudo apt-get install -y nvidia-driver-440

# Reboot. Check that GPUs are visible using the command: nvidia-smi

# Install development and runtime libraries (~4GB)
# sudo apt-get install --no-install-recommends \
#     cuda-10-0 \
#     libcudnn7=7.6.2.24-1+cuda10.0  \
#     libcudnn7-dev=7.6.2.24-1+cuda10.0
sudo apt-get install -y cuda-10-0 libcudnn7 libcudnn7-dev

# sudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1
# sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2
# sudo update-alternatives --set python /usr/bin/python3.6

sudo apt install -y python3-pip
sudo pip3 install --upgrade pip
sudo pip3 install numpy scipy matplotlib ipython sympy pandas jupyterlab
sudo pip3 install PyMySQL imbalanced-learn xgboost scikit-learn statsmodels
sudo pip3 install seaborn pmdarima lxml html5lib requests beautifulsoup4
sudo pip3 install tensorflow tensorflow-gpu keras
jupyter lab --no-browser
